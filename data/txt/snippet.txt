graph TD
    subgraph Fase de Análise (O Scanner)
        A[▶ Início do Loop Principal] --> B{Para cada cripto na Watchlist};
        B --> C[1. Obter dados recentes<br>(preço e volume)];
        C --> D{2. Critérios de Breakout Atendidos?<br>(Preço subiu X% E<br>Volume subiu Yx?)};
        D -- Não --> B;
        D -- Sim --> E[<strong>!!! BREAKOUT DETECTADO !!!</strong>];
    end

    subgraph Fase 1: Operação de Breakout (Long)
        E --> F[3. Executar Ordem de Compra<br>a Mercado (LONG)];
        F --> G[4. Definir Stop-Loss e<br>Alvo de Lucro/Trailing Stop];
        G --> H{5. Monitorar Posição LONG};
        H -- Preço atinge Stop-Loss<br>(Perda) --> I[X Encerrar Posição];
        H -- Preço atinge Trailing Stop<br>(Lucro) --> I;
        H -- Sinais de Exaustão Detectados?<br>(Volume cai, RSI diverge, etc.) --> J[✔ Fechar Posição LONG<br>(Realizar Lucro)];
    end

    subgraph Fase 2: Operação de Reversão (Short)
        J --> K[6. Executar Ordem de Venda<br>a Mercado (SHORT)];
        K --> L[7. Definir Stop-Loss e<br>Alvo de Lucro para o SHORT];
        L --> M{8. Monitorar Posição SHORT};
        M -- Preço atinge Alvo de Lucro<br>(Queda esperada) --> I;
        M -- Preço atinge Stop-Loss<br>(Movimento continua a subir) --> I;
    end

    I --> Z[Esperar próximo ciclo];
    Z --> A;

    %% Styling
    style E fill:#f9f,stroke:#333,stroke-width:2px
    style F fill:#cde,stroke:#333,stroke-width:2px
    style J fill:#dfd,stroke:#333,stroke-width:2px
    style K fill:#ffc,stroke:#333,stroke-width:2px
    style I fill:#fbb,stroke:#333,stroke-width:2px